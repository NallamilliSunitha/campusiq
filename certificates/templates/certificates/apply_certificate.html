{% extends "base.html" %}
{% block content %}

{% with role=profile.role|default:""|lower %}

<div class="max-w-5xl mx-auto mt-10 space-y-6">

  <div class="bg-white shadow-lg rounded-2xl p-8">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
      <div>
        <h2 class="text-2xl font-bold text-gray-800">Certificate Module</h2>
        <p class="text-gray-500 mt-1">
          Apply for certificates or manage requests (Dean/Principal).
        </p>
      </div>

      <div class="flex gap-2 flex-wrap">
        {% if role == "dean" or role == "principal" %}
          <a href="{% url 'received_certificate_requests' %}"
             class="bg-green-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-700">
            üì® Certificate Requests
          </a>
        {% else %}
          <a href="{% url 'my_certificates' %}"
             class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700">
            üìÇ My Certificates
          </a>
        {% endif %}

        <a href="{% url 'dashboard' %}"
           class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">
          ‚Üê Back
        </a>
      </div>
    </div>
  </div>

  {% if role != "dean" and role != "principal" %}

  <div class="bg-white shadow-lg rounded-2xl p-8">
    <h3 class="text-xl font-semibold text-gray-800 mb-4">Apply for Certificate</h3>

    {% if error %}
      <div class="mb-4 p-3 rounded bg-red-50 text-red-700 border border-red-200">
        {{ error }}
      </div>
    {% endif %}

    <form method="POST" enctype="multipart/form-data" class="space-y-5">
      {% csrf_token %}

      <div>
        <label class="block text-gray-700 font-semibold mb-1">Certificate Type</label>
        <select name="cert_type" required class="w-full border rounded-lg px-4 py-2">
          <option value="">Select certificate</option>
          <option value="study">Study Certificate</option>
          <option value="bonafide">Bonafide Certificate</option>
          <option value="tc">Transfer Certificate (TC)</option>
          <option value="marks_memo">Marks Memo</option>
        </select>
      </div>

      <div>
        <label class="block text-gray-700 font-semibold mb-1">Purpose</label>
        <textarea name="purpose" rows="4" required
                  class="w-full border rounded-lg px-4 py-2"
                  placeholder="Example: Required for internship / scholarship / bank loan / visa / etc."></textarea>
      </div>

      <div>
        <label class="block text-gray-700 font-semibold mb-2">
          Upload Supporting Files (Optional)
        </label>
        <input type="file" name="supporting_files" multiple
               class="w-full border rounded px-4 py-3">
        <p class="text-xs text-gray-500 mt-1">
          Upload any required documents (if applicable). You can select multiple files.
        </p>
      </div>

      <div class="text-right">
        <button type="submit"
                class="bg-indigo-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-indigo-700">
          Submit Request
        </button>
      </div>
    </form>
  </div>

  {% else %}

  <div class="bg-white shadow-lg rounded-2xl p-8 text-center">
    <h3 class="text-xl font-semibold text-gray-800">Authority Panel</h3>
    <p class="text-gray-500 mt-2">
      You cannot apply for certificates. Use <b>Certificate Requests</b> to manage assigned requests.
    </p>
  </div>

  {% endif %}

</div>

{% endwith %}
{% endblock %}
